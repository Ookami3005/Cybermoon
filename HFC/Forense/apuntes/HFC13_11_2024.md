[<- Índice](../Forense.md)
## Formato de almacenamiento de datos

Dependiendo del equipo, algunos datos pueden ser almacenados con uno de los siguientes formatos:

Por ejemplo, analicemos el valor hexadecimal *EC FE 01 11*.

#### *Big Endian*

> La información se almacena en un "orden natural", donde el *byte* más significativo se almacena en la dirección más baja

| Byte 0 | Byte 1 | Byte 2 | Byte 3 |
| ------ | ------ | ------ | ------ |
| *EC*   | *FE*   | *01*   | *11*   |

Es utilizada por procesadores como:

- Arquitecturas *IBM*
- Freescale Coldfire (*Motorola*)
- Atmel AVR32
- Open RISC

#### *Little Endian*

> El *byte* más significativo se escribe en la dirección más alta.

| Byte 0 | Byte 1 | Byte 2 | Byte 3 |
| ------ | ------ | ------ | ------ |
| *11*   | *01*   | *FE*   | *EC*   |

Frecuente en procesadores como:

- Series x86-64 Intel x86 y AMD64
- Nios II
- Andes technology
- Qualcomm Hexagen

## Capas de un Sistemas de Archivos

1. Fisica (*Fierros*)
2. Sistema de archivos (*Directorio*)
3. Datos (*Datos*)
4. Metadatos (*Metadatos*)
5. Nombre de archivo (*Referencias*)
6. Aplicación (*Cuotas*)

### Capa física

#### Composición Física

Se consideran los siguientes componentes como parte de la capa física:

- Disco
- Brazo
- Cabeza
- Motor

#### Composición lógica

Los dispositivos de almacenamiento pueden ser seleccionados de manera lógica para organizar mejor los datos.

### Capa de sistema de archivos

> Contiene los datos generales que identifican como éste sistema de archivos es único y dónde se encuentran demás datos importantes.

En la mayoría de los casos estos datos se encuentran almacenados

#### Volumen

Conjunto de sectores direccionables que pueden ser usados para almacenamiento de datos por un sistema operativo o aplicación. Por ejemplo, RAID

#### Particion

Tipo particular de volumen, es una colección de sectores consecutivos en un volumen.

##### Esquemas de particionamiento

> Definen de que forma se almacena la información en un dispositivo.

###### *DOS* (Disk Operating System)

- Ampliamente utilizado debido a que fue el primer esquema de particionamiento.
- Solo para discos menores a 2 TB
- Define una estructura de datos en los primeros 512 *bytes* del dispositivo, recibe el nombre de *MBR* (*Master Boot Record*)
- La Estructura *MBR* se conforma de los siguientes elementos:
	- Código de arranque
	- Tabla de particiones
	- Identificador de fin de la estructura *MBR*
- La tabla de particiones únicamente puede describir 4 particiones.

###### *GPT* (GUID Partition Table)

- Ampliamente utilizado en servidores
- Para sistemas *x64*
- Utiliza estructuras de datos redundantes

En este curso nos centraremos en el aprticionado tipo **DOS**.

#### Estructura MBR

##### Código de arranque

Serie de instrucciones que define la elección de la partición a iniciar, que es donde se encuentra el sistema operativo principal.

##### Tabla de particiones

Esta tabla reserva 16 *bytes* para definir una partición, es posible especificar hasta cuatro particiones en la *MBR*. Una de esas particiones puede ser de tipo extendida.

##### Identificador de fin de la estructura

El valor *0xAA55* espresa el final del *MBR*.

Cada entrada de partición tiene 16 *bytes* de longitud.

1. Primera partición -> 0x1BE o 445 bytes
2. Segunda partición ->

| Offset (dec) | Longitud (bytes) | Contenido                                                                                                 |
| ------------ | ---------------- | --------------------------------------------------------------------------------------------------------- |
| **0**        | **1**            | Bandera de partición de arranque: `0x80` boot                                                             |
| **1**        | **1**            | Cabezal donde inicia la partición                                                                         |
| **2**        | **2**            | Sector y cilindro donde inicia la partición                                                               |
| **4**        | **1**            | Tipo de partición                                                                                         |
| **5**        | **1**            | Cabezal donde finaliza la partición                                                                       |
| **6**        | **2**            | Sector y cilindro donde finaliza la partición                                                             |
| **8**        | **4**            | Distancia en sectores, desde la tabla de particiones al primer sector de la partición (sector de inicio). |
| **12**       | **4**            | Número de sectores en la partición (longitud de la partición)                                             |

##### Tipos de particiones

***Sistemas de archivos***: Almacenan un sistema de archivos

***Primaria***
Unicamente son configurables en el *MBR* princippal de la unidad de almacenamiento.

Solo pueden existir un máximo de 4 particiones primarias de sistemas de archivos por unidad de almacenamiento.

**Secundaria**

Se encuentran asociadas a las particiones que son configuradaas en la partición extendida primaria.

*"Unicamente"* existe una partición de sistemas de archivo secundario por cada partición extendida secundaria.

***Particiones extendidas***: La tabla de particion tiene solo cuatro entradas, las cuales no son suficientes para los sistemas actuales.

Cada partición extendida contiene su propia tabla de particiones donde se define *"solo"* una nueva partición de archivos.

***Primaria***

Unicamente existe una por cada unidad de almacenamiento.

Unicamente son configurables en el MBR principal de la unidad de almacenamiento.

***Secundaria***

Son utilizadas para almacenar únicamente una partición de sistemas de archivos secundaria.

---

## Herramientas

#### SleuthKit

> Estas herramientas de sistemas de archivos procesan las estructuras de metadatos, las cuales almacenan los detalles de un archivo.

Ejemplos de este tipo de estructuras incluyen entradas de directorios en formatos *FAT*, *MFT*, entradas de *NTFS* e inodos en *ExtX* y *UFS*.