[<- Índice](../Pentesting.md)
# Nmap básico

> ***Nmap*** es una de las herramientas más poderosas de ciberseguridad jamás creadas, a lo largo de los ==más de 20 años== que lleva existiendo se ha convertido en un ***estándar del reconocimiento activo*** tanto para labores ofensivos como defensivos.

A pesar de que *Nmap* destaca como un perfecto ***escáner de puertos***, no hay que olvidar que es una herramienta altamente versátil capaz de darnos aún más que un simple escaneo.

Antes de leer esta nota, recomiendo altamente tener una noción básica acerca de capas de red, puertos y protocolos de transporte, pues obviaré algunos conceptos y términos.

### Escaneo de puertos

> La **idea básica** de un ***escaneo de puertos*** es determinar que puertos de un dispositivo están ==abiertos a la comunicación== y cuales no.

***¿Y porque nos interesa eso?*** Pues básicamente, queremos saber que ***servicios*** está ofreciendo dicho dispositivo o que maneras de ***interactuar*** con él poseemos.

Por ejemplo si el dispositivo tiene el puerto **80** abierto, por convención, podemos pensar que está ofreciendo un servicio *HTTP* como servidor, o dicho más simple, que esta levantando una página *web* en Internet o alguna otra red.

Sabiendo esto, sabemos que podemos interactuar con nuestra navegador por ejemplo, con el dispossitivo para inspeccionar el contenido *web* y demás acciones.

#### Procedimiento técnico

> ***¿Y como hace este escaneo la herramienta?*** Para determinar el estado del puerto, *Nmap* intenta iniciar una sesión *TCP* con el objetivo mediante el típico *Three Way HandShake*.

Es decir, recordando el *Three Way HandShake*, *Nmap* envía un paquete de red con la bandera *SYN* activa en el segmento *TCP*.

Esto se realiza con la intención de indicar al servidor que deseamos establecer una conexión con él, y esperamos que nos responda con otro paquete con la bandera *ACK*.

Si sucede esto, *Nmap* envía un paquete con las banderas *SYN/ACK* para confirmar la conexión y a nosotros como usuarios, nos indica que el puerto está ***abierto***.

Por otra parte, si *Nmap* recibe un paquete con la bandera *RST* activa, nos indica que el puerto está ***cerrado*** y no desea establecer ninguna conexión.

Además, podría ser que *Nmap* no reciba ninguna respuesta por parte del objetivo, ni de confirmación ni de negación ni nada, entonces *Nmap* asume la comunicación está interferida por un *Firewall* y nos indica que el puerto está ***filtrado***.

### Uso básico

Ahora que conocemos los fundamentos, podemos hablar sobre el uso de la herramienta, pero antes quiero advertir algo importante.

A pesar de que no es formalmente un crimen, **escanear sin permiso es percibido como una amenaza potencial**, pues este tipo de reconocimiento es parte de un ==ataque real==.

Por favor asegurate que el objetivo que selecciones para escanear sea seguro y/o permitido de hacerlo, o al menos que este consciente de tus actividades.
Incluso puedes usar otros ordenadores tuyos como objetivos, mquinas virtuales o tu propio modem de internet.

> Volviendo al tema, para realizar un escaneo simplemente debemos invocar `nmap` junto con el ***dirección IP*** o ***nombre de dominio*** del objetivo, pues *Nmap* puede resolverlo a dirección *IP* sin problema.

```bash
# Mi modem
nmap 192.168.90.1

# Página demo para escanear de Nmap
nmap scanme.nmap.org
```

### Opciones recomendadas

> *Nmap* posee una infinidad de opciones, muchas de las que planeo cubir en notas subsecuentes, sin embargo hay una pequeña selección de ellas que considero útiles en todos los escenarios por la información que proveen y que considero deberían formar parte de cualquier escaneo.

##### Versiones de servicio

Indicando la bandera `-sV` al comando, *Nmap* intentará averiguar las ==versiones de los servicios corriendo en el objetivo== y el sistema operativo del objetivo para informarnoslo en la salida.

```bash
nmap -sV scanme.nmap.org

# ...
# PORT      STATE    SERVICE    VERSION
# 22/tcp    open     ssh        OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
# 25/tcp    filtered smtp
# 53/tcp    open     domain     (generic dns response: NOTIMP)
# 80/tcp    open     http?
# 9929/tcp  open     nping-echo Nping echo
# 31337/tcp open     tcpwrapped
# ...
# Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

##### Indicando un rango de puertos

##### Escaneo "sigiloso"