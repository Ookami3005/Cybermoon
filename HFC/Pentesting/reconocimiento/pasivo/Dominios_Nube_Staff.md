[<- Índice](../../Pentesting.md)
# Enumeración de Dominios

> La información acerca de los dominios del objetivo es un componente vital de cualquier ***Prueba de Penetración***, y no es solo por los subdominios existentes, si no por la presencia general en el *Internet* que estos representan.

Estos nombres pueden incluso proporcionamos pistas acerca del rol, funcionalidad y estructura de la infraestructura del cliente

### Certificados SSL

> Una de las primeras fuentes de información acerca de los dominios, bien pueden ser los certificados *SSL* del sitio principal del sitio web del cliente. Usualmente, estos certificados podrían incluir más de un dominio o subdominio pues puede utilizarse para todos los nombrados.

Otra alternativa, son los sitios de ***Registros de Transparencia Certificados***.
La **Transparencia de Certificados** tiene el propósito de posibilitar la verificación de los certificados digitales que permiten las conexiones seguras a través del *Internet* (*HTTPS*). Entonces todas las autoridades que brindan certificados estan obligadas a registrar los dominios que autorizan para su consulta pública.

Estos se pueden consultar en sitios como [crt.sh](https://crt.sh/)

![crt_sh_unam.png](imagenes/crt_sh_unam.png)

Incluso podemos consultarlo en formato *JSON* mediante la terminal con apoyo de *cURL* y `jq`.

```bash
curl 'https://crt.sh?q=fciencias.unam.mx&output=json' -s | jq

# ...
# {
#     "issuer_ca_id": 16418,
#     "issuer_name": "C=US, O=Let's Encrypt, CN=Let's Encrypt Authority X3",
#     "common_name": "aztlan.fciencias.unam.mx",
#     "name_value": "aztlan.fciencias.unam.mx",
#     "id": 135397916,
#     "entry_timestamp": "2017-05-10T04:39:17.722",
#     "not_before": "2017-05-10T03:39:00",
#     "not_after": "2017-08-08T03:39:00",
#     "serial_number": "038e519620aa5c9d1a8ceaa47055e738672e",
#     "result_count": 2
# },
# ...
```

E incluso podemos filtrar aun más esta salida para obtener directamente una lista de nombres de dominio, para una visualización rápida.

```bash
curl 'https://crt.sh?q=hackthebox.com&output=json' -s | jq . | grep 'name'| grep -v 'CN=' | cut -d : -f 2 | cut -d \" -f 2 | sort -u

# ...
# status.hackthebox.com
# tableau.hackthebox.com
# trust.hackthebox.com
# ...
```

### Resolución a direcciones *IP*

> Una vez obtenidos los nombres de dominio, y validado que pertenece al **alcance** de la prueba, podemos resolverlos estos dominios a sus **alias** o direcciones *IP* mediante la herramienta de tu preferencia, en este ejemplo, se realizará con `host` y a partir de un archivo `nombres.txt` que contenga algunos nombres de dominio de ejemplo.

```bash
# Alias 
for nombre in $(cat nombres.txt) ; do host $nombre | grep 'is an alias' | cut -d ' ' -f 1,6 ; done
# trust.hackthebox.com trust.cname.drata.com.

# Direcciones IP
for nombre in $(cat nombres.txt) ; do host $nombre | grep 'has address' | cut -d ' ' -f 1,4 ; done

# status.hackthebox.com 109.176.239.70
# status.hackthebox.com 109.176.239.69
# trust.cname.drata.com 172.64.146.8
# trust.cname.drata.com 104.18.41.248
```

De este modo, podemos correlacionar los auténticos nombres de dominio con sus direcciones *IP* para posteriores análisis más exhaustivos.

### Shodan

### Registros *DNS*

# Enumeración de instancias en la nube

# Enlaces