[<- Índice](../../../Pentesting.md)
# Server Message Block

> ***SMB*** (*Server Message Block*) es un protocolo de capa de aplicación que, bajo un modelo servidor-cliente, regula el acceso a archivos, directorios y demás recursos de red como impresoras, *routers* o interfaces. Además, permite el intercambio de información entre distintos procesos a través de la red.

Aunque en sus inicios fue un protocolo acogido por una gran variedad de público, con el tiempo fue integrado de forma más particular a sistemas operativos *Windows*, donde se implemento *SMB* con un enfoque **retrocompatible** para que los nuevos equipos pudieran comunicarse con los viejos equipos, a pesar de la versión de sistema operativo *Windows* que tuvieran.

Adicionalmente, con el surgimiento de ***Samba***, la comunicación entre distintas plataformas *Linux* y *Windows* es posible mediante *SMB*.

El protocolo *SMB* tambien permite la comunicación del cliente con otros participantes de la red para acceder a archivos y servicios en toda la red, siempre que ambos hayan establecido la conexión con el servidor como intermediario.

*SMB* se basa en el protocolo de transporte ***TCP*** para el establecimiento de sesiones y para transmisiones más seguras y estables.

Tambien hay que notar que la jerarquía de un **servidor SMB** es parcialmente independiente de la estructura del servidor.
Los **permisos** de los recursos se definen segun la ***ACL*** (*Access Control Lists*), que permite controlar granularmente los atributos como la **ejecución**, **lectura**, **escritura** y **control total** para cada usuario y grupo.
Recordemos que el *ACL* define estas propiedades en los recursos compartidos y no son forzosamente iguales a los permisos locales del servidor.

## Samba

> Como se menciono anteriormente, **Samba** es una implementación de código libre del protocolo *SMB*, principalmente pensada para dipositivos *UNIX*. *Samba* basa principalmente su implementación en el protocolo de red ***CIFS*** (*Common Internet File System*) que se considera un dialecto de *SMB* originalmente creado por *Microsoft*, permitiendo que *Samba* se comunique perfectamente con dispositivos modernos.

Por esto último, *Samba* es también conocido como *SMB/CIFS*.

***CIFS*** se alínea más a la primera versión disponible de *SMB* con la única diferencia del puerto por defecto del servicio, pues los dispositivos más antiguos establecian las conexiones a través de los puertos 137, 138 o 139, mientras que ***CIFS*** únicamente opera en el puerto 445.

#### Versiones

Existen muchas versiones de *SMB*, desde la **versión 1** hasta versiones modernas como ***SMB 2*** y ***SMB 3*** que ofrecen significativas mejoras y optimizaciones para infraestructuras modernas, dejando obsoleta a la versión 1 y a ***CIFS***, aunque aún se utilicen estás en ciertos ambientes.

![versionesSMB.png](imagenes/versionesSMB.png)

Con la versión 3, *SMB* incluso fue incorporado a *Active Directory*.

#### Conceptos importantes

En una red *SMB*, cada dispositivo participa en un **grupo de trabajo** (*workgroup*) donde se comparten los recursos. Este **grupo de trabajo** identifica a todos los recursos que se deseen compartir con los otros miembros en el grupo y puede haber varios grupos según la organización y segmentación en la organización.



# Enlaces

[<- FTP](FTP.md) | 