[<- Índice](../../../Pentesting.md)
# IMAP y POP3

> ***IMAP*** (*Internet Message Access Protocol*) y ***POP3*** (*Post Office Protocol*) son protocolos de aplicación con el objetivo de permitir el acceso a los correos electrónicos de un **servidor de correo**. Funcionan como una especie de **buzones de correo** que almacenan los correos recibidos y los presenta de una mejor manera al usuario y a las aplicaciones.

### POP3

***POP3*** es el protocolo más simple, el cual permite autenticar un usuario, listar los correos recibidos, inspeccionar el contenido de un correo, borrar correos y poco más. 

Este servicio sigue un modelo de comunicación **cliente-servidor** y se encuentra a la escucha en el puerto por defecto 110, en texto plano, mientras que su versión integrada con encriptación *TLS/SSL*, denominada **POP3S** se encuentra a la esucha en el puerto 995.

### IMAP

Por otra parte, ***IMAP*** es más avanzado que implementa muchas mejoras y funcionalidades nuevas en contraste con *POP3*, por ejemplo:

- Permite la organización de correos mediante **cajas** (*mailboxes*)
- Permite la sincronización de **buzones locales** con los correos en el servidor.
- Creación de copias locales
- Autenticación del usuario

***IMAP*** se encuentra a la escucha en el puerto 143, en texto claro, donde puede recibir una serie de comandos para interactuar con el cliente. Por otra parte, su versión con *TLS/SSL* ***IMAPS***, se encuentra a la escucha en el puerto 993. 

Los comandos en este protocolo son acompañados por un número al inicio que se considera su **identificador**.
Con estos **identificadores**, puede recibir una rápida sucesión de comandos sin esperar las respuestas del servidor, y una vez que este las procese, devolvera la respuesta junto con el **indicador** del comando correspondiente.

Además, su funcionalidad por **cajas** es lo que hoy en día permite la organización de los correos electrónicos según sean del buzon de entrada, borradores, enviados, spam, etc.

## Comandos

> Para este protocolo, tomaremos de ejemplo los servicios *Dovecot*, que posee una variante para *POP3* (`dovecot-pop3d`) y para *IMAP* (`dovecot-imapd`). Estos poseen una gran cantidad de opciones configurables que se dividen principalmente en **ajustes principales** y **ajustes particulares** para cada variante y que permiten regular el comportamiento del servidor según nuestras necesidades.

Es importante reconocer los comandos que cada protocolo admite para poder enumerar correctamente el servidor de manera manual, de modo que a continuación presentamos los más relevantes para cada protocolo.

Recordemos que en *IMAP* cada comando va acompañado de un número identificador, para estos ejemplos, utilizaremos siempre un 1.

#### IMAP

| Comando                         | Descripción                                                                               |
| ------------------------------- | ----------------------------------------------------------------------------------------- |
| `1 LOGIN username password`     | Mediante este comando indicamos las credenciales para iniciar sesión en el servidor.      |
| `1 LIST "" *`                   | Lista todas las **cajas de correo** presentes.                                            |
| `1 CREATE "INBOX"`              | Crea una nueva **caja de correo**, en este caso, con el nombre *INBOX*.                   |
| `1 DELETE "INBOX"`              | Borra una **caja de correo**, en este ejemplo, la que se llame *INBOX*.                   |
| `1 RENAME "ToRead" "Important"` | Renombra una **caja de correo**.                                                          |
| `1 LSUB "" *`                   | Devuelve un conjunto de nombres de cajas marcadas como **activass** o como **suscritas**. |
| `1 SELECT INBOX`                | Selecciona la caja de correo *INBOX*, para posteriormente poder listar su contenido.      |
| `1 UNSELECT INBOX`              | Anula la selección sobre la caja *INBOX*.                                                 |
| `1 FETCH <ID> all`              | Recupera el contenido del correo según los identificadores indicados.                     |
| `1 CLOSE`                       | Elimina permanentemente todos los mensajes marcados como *"Borrados"*.                    |
| `1 LOGOUT`                      | Cierra la sesión y termina la conexión con el servidor.                                   |

#### POP3

| Comando         | Descripción                                                                  |
| --------------- | ---------------------------------------------------------------------------- |
| `USER username` | Indica el usuario con el que se desea iniciar sesión.                        |
| `PASS password` | Indica la contraseña del usuario indicado e inicia sesión en el servidor.    |
| `STAT`          | Solicita el numeros de correos almacenados en el servidor.                   |
| `LIST`          | Lista los correos presentes en el servidor junto con su tamaño en cada caso. |
| `RETR id`       | Se le indica el número del correo y recupera su contenido.                   |
| `DELE id`       | Elimina el correo con el número de identificación que se le indique.         |
| `CAPA`          | Solicita las características y funcionalidades del servidor.                 |
| `RSET`          | Solicita al servidor resetear toda la información transferida en la sesión.  |
| `QUIT`          | Cierra la sesión y termina la conexión con el servidor.                      |

# Enlaces

[<- SMTP](SMTP.md)