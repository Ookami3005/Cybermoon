[<- Índice](../../../Pentesting.md)
# Network File System

> ***NFS*** (*Network File System*) es otro protocolo de aplicación más con el mismo objetivo que *SMB*, permitir el acceso a sistemas de archivos a través de la red como si fueran locales. Sin embargo, *NFS* se desarrollo como un protocolo completamente distinto, lo que lo hace incompatible de primeras con servidores *SMB*.

*NFS* se ha vuelto un estándar en el *Internet* para la gestión de procesos remotos en sistemas distribuidos, y algunas características importantes de sus versiones son:

| Versión | Características                                                                                                                                                                     |
| ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| *NFSv2* | Aunque viejo, soporta la mayoría de los sistemas y opera completamente sobre el protocolo *UDP*.                                                                                    |
| *NFSv3* | Tiene más funcionalidades, como flexibilidad en el tamaño de los archivos, un mejor reporte de errores y más estabilidad, pero no es completamente compatible con clientes *NFSv2*. |
| *NFSv4* | La versión más moderna, incluye compatibilidad con *Kerberos*, manejo de *Firewalls*, soporta *ACL's* y ofrece muchas mejoras de rendicimiento y seguridad.                         |

Otra ventaja significativa de *NFSv4* consiste en que, por defecto, únicamente corre el servicio sobre el puerto **2049** ya sea *TCP* o *UDP*.

*NFS* se basa principalmente en el protocolo ***ONC-RPC/SUN-RPC*** (*Open Network Computing Remote Procedure Call*), expuesto en el puerto **111** ya sea *TCP/UDP*, que utiliza ***Representación Externa de Datos*** (*XDR* por sus siglas en inglés) para el intercambio de datos entre sistemas independientes.

A pesar de la modernidad de *NFS*, este no tiene formalmente un mecanismo de **autenticación** ni de **autorización**. Cualquiera puede interactuar con el servicio y es el servidor el que se encarga de traducir la información de usuario del cliente al formato del **sistema de archivos** del servidor, intentando definir su autorización lo más preciso posible, lo que varía mucho dada su configuración.

Una de las principales ***formas de autorización***, en sistemas *UNIX*, son las identificaciones *UID/GID* y los permisos de los grupos. Claro, este mecanismo no es nada preciso pues los *UID/GID* pueden variar completamente y el servidor no tiene forma de hacer más comparaciones.

Por esto mismo, ==*NFS* la autorización por UID/GID únicamente se utiliza en redes privadas y de confianza==.

## Configuración

> *NFS* no es muy dificil de configurar, pues no tiene tantas opciones como *FTP* o *SMB*. Su archivo de configuración es `/etc/exports` que contiene una tabla de los directorios locales que se harán accesibles a los clientes.

Algunas opciones configurables para *NFS* son:

| Opción             | Descripción                                                                                                                                                                             |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `rw`               | Se permite la lectura y escritura de archivos                                                                                                                                           |
| `ro`               | Unicamente se permite la lectura de archivos                                                                                                                                            |
| `sync`             | La transferencia de datos es sincrónica pero un poco más lenta.                                                                                                                         |
| `async`            | La transferencia de datos es asincrónica                                                                                                                                                |
| `secure`           | No se permite utilizar puertos arriba de 1024                                                                                                                                           |
| `insecure`         | Si se permiten puertos arriba de 1024                                                                                                                                                   |
| `no_subtree_check` | Esta opción deshabilita la revisión de subdirectorios                                                                                                                                   |
| `root_squash`      | Los permisos de archivos pertenecientes a *root* (*UID/GID* 0) se asignan automáticamente al *UID/GID* de un usuario `anonymous` para prevenir la creación de archivos de superusuario. |

Este archivo de configuración es muy corto y podría verse algo así:

```txt
# /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
```

# Enlaces

[<- SMB](SMB.md)