[<- Índice](../../../Pentesting.md)
# Oracle Transparent Network Substrate

> ***Oracle TNS*** (*Oracle Transparent Network Substrate*) es un protocolo de **comunicación** que facilita la interacción entre **bases de datos Oracle** y cualquier aplicación (o cliente) a través de la red.

Introducido originalmente como parte del grupo de *software* **Oracle Net Services**, actualmente *OracleTNS* es compatible con múltiples protocolos de red como *IPX/SPX*, *AppleTalk*, el típico *TCP/IP*, etc.
Además, con el tiempo, se ha actualizado para ser compatible con tecnologías modernas como *IPv6* y cifrado *TLS/SSL*.

Por esto, se ha vuelto una opción preferida para administrar enormes y complejas bases de datos donde la compatibilidad y conexión son mandatorias, por ejemplo, en el sector salud, en finanzas, industrias, etc.
Otros usos comunes podrían ser:

- Resolución de nombres (*DNS*)
- Administración de conexiones y comunicaciones
- Balance de cargas
- Seguridad

Adicionalmente, *OracleTNS* posee mecanismos propios de encriptación en las comunicaciones propiciando así la seguridad de la información que se encuentra en tránsito.
Por otra parte, *OracleTNS* provee herramientas y funcionalidades avanzadas para la administración de las bases de datos, como herramientas de análisis, reporte de errores, de *logging*, administración de la carga de trabajo, etc.

## Configuración

> La configuración por defecto de *OracleTNS* varía mucho dependiendo de la versión y edición del *software* instalado. Sin embargo, si podemos nombrar algunas opciones en común que poseen todas estas variantes de *OracleTNS*.

Para empezar, por defecto el servicio se encuentra a la escucha en el puerto **TCP/1521**, aunque este y las interfaces de red donde se escucha podrían modificarse durante la instalación o en la configuración posterior.

Se puede configurar el protocolo de red subyaciente que utilizará este servicio, ya sea *TCP/IP*, *UDP*, *IPX/SPX* o *AppleTalk*.

En las versiones **8i/9i** de *OracleTNS* la administración remota esta activa por defecto, sin embargo, en las versiones **10g/11g** no, por lo que habría que activarse manualmente.

> En cuanto a opciones de **seguridad**, podemos definir una *whitelist* de *hosts* a los que se les permite conectarse al servicio, podemos configurar un mecanismo básico de autenticación por usuario y contraseña, habilitar la encriptación de las comunicaciones, etc.

Los archivos de configuración principales, donde se definen muchas de las opciones descritas anteriormente, son `tnsnames.ora` y `listener.ora` y usualmente se encuentran en la ruta `$ORACLE_HOME/network/admin` (`$ORACLE_HOME` puede variar pero usualmente es `/opt/oracle` o `/usr/local/oracle` en sistemas *Linux* o `C:\oracle` en *WIndows*).

*OracleTNS* es usualmente utilizado en conjunto con otros servicios de *Oracle* como:

- *Oracle DBSNMP*
- *Oracle Databases*
- *Oracle Application Server*
- *Oracle Enterprise Manager*

Entonces, es buena idea familiarizarse un poco con ellos si encontramos presente *OracleTNS* en nuestro objetivo.
Podríamos identificar información valiosa como la contraseña por defecto `dbsnmp` de *Oracle DBSNMP* o la presencia del obsoleto servicio *Finger* que pone en riesgo muchoss ervicios de *Oracle* con los conocimientos adecuados.

#### Tnsnames.ora

Este archivo contiene toda la información necesaria para que un cliente se conecte a cada servicio, que son datos como:

- Nombre del servicio
- Dirección y puerto de escucha
- Nombre de servicio (aquel que debe usarse para conectarse)

Un ejemplo de la definición de un servicio en el archivo sería:

```txt
ORCL =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 10.129.11.102)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
```

En esta muestra, se define un servicio **ORCL** que esta a la escucha en la *IP* `10.129.11.102`, en el puerto `1521`, protocolo *TCP*.
El **nombre del servicio** ***necesario*** para la conexión es `orcl` y esta indicado hasta abajo de la muestra.
En este mismo archivo, puede configurarse más de un servicio o base de datos de igual manera que el ejemplo, ademas podemos indicar detalles de la autenticación, del establecimiento de conexiones y del balance de cargas.

#### Listener.ora

El otro archivo de configuración importante, `listener.ora`, define detalles y propiedades del *Listener* más enfocados al lado del servidor, acerca de como manejar solicitudes entrantes de un cliente e interactuar con la base de datos adecuada.

```txt
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = PDB1)
      (ORACLE_HOME = C:\oracle\product\19.0.0\dbhome_1)
      (GLOBAL_DBNAME = PDB1)
      (SID_DIRECTORY_LIST =
        (SID_DIRECTORY =
          (DIRECTORY_TYPE = TNS_ADMIN)
          (DIRECTORY = C:\oracle\product\19.0.0\dbhome_1\network\admin)
        )
      )
    )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = orcl.inlanefreight.htb)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )

ADR_BASE_LISTENER = C:\oracle
```

---

En conclusión, los servicios *Oracle* utilizan `tsnames.ora` para relacionar servicios a direcciones y puertos de red mientras que usan `listener.ora` para definir el comportamiento de los servicios.