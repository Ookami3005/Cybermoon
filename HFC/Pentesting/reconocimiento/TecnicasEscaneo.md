[<- Índice](../Pentesting.md)
# Técnicas de Escaneo

## TCP

### Principales

> En notas anteriores, ya hemos hablado sobre los 2 tipos más importantes de escaneo *TCP* para *Nmap*.

El ***escaneo de conexión completa*** (`-sT`), por defecto cuando *Nmap* se ejecuta ==sin permisos de superusuario==, que realiza un *Three Way Handshake* completo.

Y por otra parte el ***escaneo de conexión incompleta o sigilosa*** (`-sS`) que realiza un *Three Way Handshake* a medias.

Estas 2 técnicas por supuesto, son las ==más fiables a la hora de escanear puertos== lo que también las hace las técnicas mas prevenidas y detectadas por los sistemas de defensa del objetivo.

Si estamos dispuestos a sacrificar algo de precisión por un mayor sigilo, existen unas cuantas técnicas no convencionales de escaneo que podemos utilizar.

### Especiales

Las posteriores técnicas de escaneo plantean una ***ideología distinta*** de escaneo basada en las ==convenciones establecidas en los distintos documentos *RFC*==, que fungen como documentación y guia para la implementación de distintos protocolos de transporte.

Específicamente sobre la que dicta que:

> *"Cualquier **puerto cerrado** que reciba un paquete con las banderas **URG, PUSH o FIN** activas en el segmento TCP, debe considerar este paquete como **malformado** y responder un paquete con la bandera **RST**"*

\> Página 65, *RFC* 793

De esta manera, podemos identificar *"consistentemente"* puertos cerrados, sin embargo estas técnicas de escaneo son ==incapaces de determinar adecuadamente si el puerto esta abierto o filtrado== ya que en ***ambos casos*** no debe haber respuesta por parte del objetivo.

Entonces, de no recibir respuesta, estos tipos de escaneo marca al puerto como `open|filtered`.

#### FIN

> La ***técnica de escaneo FIN*** consiste en enviar un paquete con la bandera *FIN* activa, esperando la respuesta explicada anteriormente.

Podemos ejecutarlo indicando la bandera `-sF` en el comando:

```bash
sudo nmap -sF 192.168.90.1 -p 1-150

# Initiating FIN Scan at 10:46
# 
# Scanning 192.168.90.1 [150 ports]
# 
# Completed FIN Scan at 10:46, 1.23s elapsed (150 total ports)
# 
# Nmap scan report for 192.168.90.1
# Host is up (0.021s latency).
# 
# Not shown: 146 closed tcp ports (reset)
# 
# PORT   STATE         SERVICE
# 22/tcp open|filtered ssh
# 23/tcp open|filtered telnet
# 53/tcp open|filtered domain
# 80/tcp open|filtered http
# 
# Nmap done: 1 IP address (1 host up) scanned in 1.45 seconds
```

#### Xmas

> La ***técnica de escaneo Xmas*** envia un paquete con las banderas *FIN*, *URG* y *PUSH* activas.

Se le llama ***Xmas*** porque visto en *Wireshark*, se dice que las banderas del paquete parecen un árbol de navidad.

![nmap-xmas.png](imagenes/nmap-xmas.png)

Se ejecuta con la bandera `-sX`:

```bash
sudo nmap -sX 192.168.90.1 -p1-150 -v

# Initiating XMAS Scan at 10:46
# 
# Scanning 192.168.90.1 [150 ports]
# 
# Completed XMAS Scan at 10:46, 1.23s elapsed (150 total ports)
# 
# Nmap scan report for 192.168.90.1
# Host is up (0.021s latency).
# 
# Not shown: 146 closed tcp ports (reset)
# 
# PORT   STATE         SERVICE
# 22/tcp open|filtered ssh
# 23/tcp open|filtered telnet
# 53/tcp open|filtered domain
# 80/tcp open|filtered http
# 
# Nmap done: 1 IP address (1 host up) scanned in 1.45 seconds
```

#### NULL

> La ***técnica de escaneo NULL*** consiste en enviar un paquete ==sin banderas activas==, pues de igual manera muchos sistemas lo tratan como un **paquete malformado** y responden con el esperado *RST* en caso de estar cerrado.

Se ejecuta con la bandera `-sN`:

```bash
sudo nmap -sN 192.168.90.1 -p1-150 -v

# Initiating NULL Scan at 10:46
# 
# Scanning 192.168.90.1 [150 ports]
# 
# Completed NULL Scan at 10:46, 1.23s elapsed (150 total ports)
# 
# Nmap scan report for 192.168.90.1
# Host is up (0.021s latency).
# 
# Not shown: 146 closed tcp ports (reset)
# 
# PORT   STATE         SERVICE
# 22/tcp open|filtered ssh
# 23/tcp open|filtered telnet
# 53/tcp open|filtered domain
# 80/tcp open|filtered http
# 
# Nmap done: 1 IP address (1 host up) scanned in 1.45 seconds
```

---

Aunque interesantes, se sabe que estas 3 técnicas de escaneo ==fallan contra muchos sistemas Microsoft== pues estos no implementaron esta respuesta *RST* en sus puertos cerrados.

Por eso debo remarcar que aunque son escaneos muy interesantes y potencialmente sigilosos, no plenamente consistentes ni confiables.

## UDP

# Enlaces

[<- Enumeración de *Hosts*](EscaneoHosts.md) |