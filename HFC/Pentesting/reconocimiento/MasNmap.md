[<- Índice](../Pentesting.md)
# Más opciones de Nmap

> En esta nota, busco explicar más opciones utiles de *Nmap* que, si bien **no son de primera necesidad**, pueden resultarnos de ayuda dependiendo de nuestra situación, objetivo o contexto.

### Detección de Sistemas Operativos

> *Nmap* es capaz de ofrecer un procedimiento de ***detección de sistema operativo*** mediante el análisis de patrones e información hallada en las respuestas de red ofrecidas por el dispositivo.

Es decir, *Nmap* envía múltiples paquetes *TCP* y *UDP* y ***analiza profundamente*** las respuestas recibidas para ==identificar patrones característicos de ciertos sistemas operativos==, que es capaz de comparar con una ***amplia base de datos de patrones de sistemas operativos*** incluida junto con la herramienta.

Solo hay que indicar la bandera `-O` para activar la ***detección de sistemas operativos***.

```bash
sudo nmap -O scanme.nmap.org

# ...
# PORT      STATE    SERVICE
# 22/tcp    open     ssh
# 25/tcp    filtered smtp
# 53/tcp    open     domain
# 80/tcp    open     http
# 9929/tcp  open     nping-echo
# 31337/tcp open     Elite
# 
# Aggressive OS guesses: Linux 4.19 - 5.15 (97%), Linux 4.15 (93%), IPFire 2.27 (Linux 5.15 - 6.1) (92%), Linux 5.4 (92%), Linux 5.0 - 5.14 (90%), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3) (90%), Linux 3.11 - 4.9 (90%), Linux 3.2 - 3.8 (90%), Android TV OS 11 (Linux 4.19) (88%), IPFire 2.25 firewall (Linux 4.14) (88%)
# No exact OS matches for host (test conditions non-ideal).
# Network Distance: 20 hops
# 
# OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done: 1 IP address (1 host up) scanned in 12.87 seconds
```

De no encontrar **patrones coincidentes exactos** con el objetivo, *Nmap* usualmente muestra una serie de probables sistemas operativos junto con el **porcentaje** de coincidencia con el objetivo, pero únicamente los mostrara de encontrar coincidencias suficientemente cercanas.

Si no los muestra, de igual manera puedes forzarlo agregando la bandera `--osscan-guess` o `--fuzzy` al comando:

```bash
sudo nmap -O --osscan-guess 192.168.90.1
```

### Informativas

> Existe una buena variedad de opciones que nos brindan más información acerca del escaneo y de los demás procedimientos realizados.

- `--reason`: Informa la razón de porque *Nmap* dedujo el estado del puerto.

- `--packet-trace`: Indica el recorrido de los paquetes enviados por *Nmap*, útil para visualizar que *"saltos"* están realizando a través de la red, por reconocimiento o por motivos didácticos.

- `--open`: Muestra unicamente los **puertos abiertos** o al menos **posiblemente abiertos**. Ignorando los cerrados y filtrados.

##### Verbosidad

- `-v`: Incrementa la verbosidad del comando, es decir, imprime más información **durante** la ejecución del escaneo. Útil para ir evaluando el estado del procedimiento por lo que es muy recomendado indicarla.
	- `-vv` o `-v2`: Doble verbosidad.
	- `-vvv` o `-v3`: Verbosidad triple.

##### Modo depurador

- `-d`: Indica el ***modo depurador***. Para cuando la verbosidad no es suficiente, imprime muchisima información detallada sobre la ejecución del comando. A menos que sospeches de algún *bug* o estes altamente familiarizado con la ejecución a bajo nivel de *Nmap* no es tan recomendable usarla.
	- `-dd` o `-d2`: Doble ifnormación en el modo depurador.
	- `-ddd` o `-d3`: Triple información.
	- `-d9`: Máximo nivel de información al depurar.

### Orden y Especificación de Puertos

> Algunas opciones acerca de la selección de puertos de *Nmap* al escanear.

- `--top-ports n`: Indica que se escaneen los `n` puertos más famosos o utilizados según el protocolo de transporte indicado (*TCP* o *UDP*). Útil para restringir la busqueda, de hecho `nmap` por defecto escanea los 1000 más utilizados (`--top-ports 1000`).
- `--exclude-ports [ports]`: No realiza el escaneo sobre los puertos proporcionados.
- `-F`: *"Fast Mode"*, cuando no se indica una selección de puertos de parte del usuario sabemos que `nmap` escanea los 1000 más utilizados pero podemos acortar esta cantidad a 100 indicando la bandera `-F` para un escaneo más rápido. Por supuesto, pierde efecto cuando se proporcionan puertos con la bandera `-p`.
- `-r`: Escanea secuencialmente los puertos. Por defecto, ==*Nmap* aleatoriza el orden de los puertos por escanear==, lo cual es bastante deseable pero si se requiere un escaneo **en orden** de los puertos podemos indicarlo con esta bandera.

# Enlaces

[<- *Nmap* básico](Nmap.md) | [Enumeración de *Hosts* ->](EscaneoHosts.md)