[<- Índice](../Pentesting.md)
# Enumeración de Hosts

> Ahora que introduje lo más adecuadamente que pude *Nmap*, quiero hablarles sobre las distintas técnicas de ***Descubrimiento de Hosts*** en una red que nos brinda *Nmap*.

Por supuesto antes de seleccionar un objetivo y escanear sus puertos, muchas veces tenemos que descubrir que hosts están **activos** en la red y cual de ellos nos interesa más.

### Listado de Hosts

> *Nmap* posee la opción `-sL` cuya única función es listar las direcciones específicadas para verificar su validez, sin realizar ningún procedimiento activo contra ellas. Sin embargo, realiza algo muy útil para la enumeración de *hosts*, una ***resolución de nombre de dominio***.

Es decir, intenta resolver cada una de las direcciones *IP* proporcionadas a su nombre de dominio, lo cual en caso de resolverse correctamente, ==puede indicarnos que dicho *host* está activo== pues posee un nombre de dominio asignado, además de la información que supone el mismo nombre.

Este tipo de reconocimiento ***no es un escaneo*** por lo que rara vez necesita de interactuar directamente con el objetivo, entonces es una forma sigilosa de recabar esta información al carecer de envío de paquetes.

Aun así, este mismo punto fuerte es su punto debil porque también ==carece de la certeza== que puede brindarte una respuesta directa del objetivo, nunca se sabe cuando el *host* podría estar abajo aunque posea un nombre de dominio.

Por esto mismo aunque útil, no recomiendo fiarse al 100% de esta forma de reconocimiento de *hosts*.

```bash
nmap -sL 8.8.8.1-10

# Starting Nmap 7.95 ( https://nmap.org ) at 2024-11-26 23:01 CST
# Nmap scan report for 8.8.8.1
# Nmap scan report for 8.8.8.2
# Nmap scan report for 8.8.8.3
# Nmap scan report for 8.8.8.4
# Nmap scan report for 8.8.8.5
# Nmap scan report for 8.8.8.6
# Nmap scan report for 8.8.8.7
# Nmap scan report for dns.google (8.8.8.8)
# Nmap scan report for 8.8.8.9
# Nmap scan report for 8.8.8.10
# Nmap done: 10 IP addresses (0 hosts up) scanned in 0.20 seconds
```

### Barrido de ping

> La manera más típica de detectar *hosts* en una red se conoce como un ***barrido de ping*** donde lanzamos una solicitud ICMP *ping* a cada posible *host* y esperamos que nos responda para concluir que está activo o de lo contrario concluiremos que está cerrado.

***¿Y como realizamos esto con Nmap?*** Pues sabemos que por regla general, *Nmap* realiza una solicitud ICMP *ping* al objetivo antes de escanear sus puertos, entonces solo hay que indicarle el rango de *hosts* por escanear y que únicamente realice el ping y no continue con el resto de la operación.

Esto se logra con la bandera `-sn`, que incluso actualmente y por si sola, ya se considera y se comporta como un ***modo de escaneo Ping*** por su alta utilidad para el descubrimiento de *hosts*.

```bash
nmap -sn 192.168.90.0/24

# Starting Nmap 7.95 ( https://nmap.org ) at 2024-11-24 12:39 CST
# Nmap scan report for 192.168.90.1
# Host is up (0.050s latency).
# Nmap scan report for 192.168.90.17
# Host is up (0.00025s latency).
# Nmap scan report for 192.168.90.46
# Host is up (0.047s latency).
# Nmap scan report for 192.168.90.66
# Host is up (0.026s latency).
# Nmap scan report for 192.168.90.75
# Host is up (0.38s latency).
# Nmap scan report for 192.168.90.78
# Host is up (0.14s latency).
# Nmap scan report for 192.168.90.80
# Host is up (0.13s latency).
# Nmap scan report for 192.168.90.117
# Host is up (0.12s latency).
# Nmap done: 256 IP addresses (8 hosts up) scanned in 23.94 seconds
```

#### ARP

Al escanear la red en la que te encuentras, *Nmap* utiliza por defecto solicitudes ARP *ping* en lugar de solicitudes ICMP.

Si por cualquier razón quisieras utilizar *ICMP*, *TCP* o cualquier tipo distinto de escaneo en lugar de *ARP* para redes locales, puedes indicarlo con la bandera `--disable-arp-ping` y ==recomiendo altamente hacerlo== ya que *Nmap* siempre va a preferir los ping *ARP* sin importar que tipo de escaneo distinto le especifiques.

### Escaneo de Hosts TCP y UDP

> Como mencione anteriormente, la manera más **típica** de verificar la actividad de un *host* es recibiendo una respuesta a una solicitud ICMP *ping*. Por eso mismo, por parte del *host*, cuando se pretende pasar desapercibido por algún reconocimiento de *hosts* se suele deshabilitar estas respuestas a solicitudes ICMP *ping*.

***¿Es este el final para nosotros como atacantes?*** Por supuesto que no, nuestro espíritu reside en burlar este tipo de medidas.

El *host* podra ocultar su actividad ante las solicitudes ICMP, pero no se pueden ocultar las ==respuestas de los puertos== (realmente si con la ayuda de un *Firewall* pero ya nos preocuparemos en otro momento).

#### TCP-SYN

Entonces podríamos optar por una nueva idea, enviar un paquete con la bandera *SYN* a uno o varios puertos del objetivo. De ==recibir una respuesta==, ya sea afirmativa o negativa podemos confirmar la actividad del objetivo.

```bash
nmap -PS22,53,80,443 -sn 192.168.90.0/24
```

Es importante indicar los puertos inmediatamente despúes de la bandera `-PS`, ==sin espacio==.

#### TCP-ACK

> Podemos realizar el mismo procedimiento descrito anteriormente pero con la bandera *ACK* mediante la bandera `-PA` en terminal, solo que en este caso se requieren de permisos de superusuario para formar adecuadamente el paquete, de lo contrario se utilizará el escaneo *TCP-SYN*.

```bash
# Red externa
sudo nmap -PA53 -sn 8.8.8.8

# Red local
sudo nmap -PA -sn 192.168.90.63 --disable-arp-ping
```

Se recomienda ==combinar estos 2 tipos de escaneo de *hosts* TCP==, ya que aumentan la probabilidad de evadir algún control (como un *Firewall*) interfiriendo la comunicación.

#### UDP

> Bajo la misma lógica, podemos realizar un reconocimiento de *hosts activos* mediante paquetes *UDP*, enviando un paquete con un datagrama *UDP* mínimo y esperando alguna respuesta *UDP* confirmativa o *ICMP* de error como señal de actividad, de lo contrario se asume que que el *host* está abajo.

```bash
sudo nmap -PU -sn scanme.nmap.org

sudo nmap -PU -sn 192.168.90.67 --disable-arp-ping
```

Aunque este tipo de escaneo es capaz de burlar *Firewall*'s configurados únicamente sobre comunicaciones *TCP*, también es menos fiable a comparación de los otros, debido a que un *host* con el puerto abierto tampoco contestaría (o es muy improbable que lo haga) al paquete enviado.

Esto se *"remedia"* enviando el paquete *UDP*, por defecto, al puerto menos utilizado (*40125*), de modo que la fiabilidad del escaneo sea la máxima pero no total.

### Escaneo agnóstico

Finalmente, ya vistas las maneras más famosas de detectar un objetivo, solo quiero explicar una cosa más.

Antes de realizar un procedimiento exhaustivo sobre algún objetivo, *Nmap* se asegura mediante un ping u otra forma como las anteriores que dicho objetivo esté activo para no desperdiciar tiempo y recursos en los procedimientos pesados como escaneo de puertos, de sistema operativo, etc.

> Si conocemos de antemano, por otra fuente, o por un procedimiento anterior que dicho objetivo está **activo** podemos indicarle a *Nmap* con la opción `-Pn` que omita la verificación y continue el procedimiento. Esto se denomina ***escaneo agnóstico***.

Es ***muy importante*** ==confirmar correctamente la actividad del objetivo== antes de indicar un escaneo agnóstico ya que en serio representa una perdida enorme de tiempo y recursos realizarlos sobre *hosts* realmente caidos.

Debido a que ==normalmente *Nmap* se negaría a escanear un objetivo que no puede verificar como activo==, este tipo de escaneos también es muy útil cuando hemos realizado por nuestra parte un procedimiento complejo de detección de *hosts* y no deseamos reindicarselo a *Nmap* para que lo repita y por fin se digne a escanear.

```bash
nmap -Pn scanme.nmap.org

nmap -Pn 192.168.90.1 --disable-arp-ping
```

Para redes locales, aun así se efectua un ping *ARP*, de modo que si deseamos evitarlo tendremos que proporcionar **una vez más** la bandera `--disable-arp-ping`.

# Enlaces

[<- Nmap básico](Nmap.md) | [Técnicas de Escaneo ->](Nmap-TecnicasEscaneo.md)