[<- Índice](../Pentesting.md)
# Post-explotación

> Una vez explotado exitosamente el objetivo, seguimos a la fase de ***Post-Explotación*** en donde buscamos obtener información local sensible y relevante que no deberiamos de tener acceso e incluso, si es posible, aumentar nuestros privilegios, establecer persistencia y otras técnicas avanzadas.

Es importante recordar que, en caso de ser una **prueba evasiva**, nos encontramos en un gran foco de vigilancia, donde incluso un comando malicioso que nos detecten podría hacer que nos echen del sistema.
En estos casos, hay que ser extremadamente cuidadosos y tomar las medidas adecuadas para evitar la detección.

### Reconocimiento

> Ahora que nos encontramos en una nueva posición en el sistema, es típico revisitar las etapas de ***Reconocimiento*** y ***Evaluación de Vulnerabilidades***, repitiendo estos procedimientos en este nuevo ambiente y perspectiva interna.

Este nuevo reconocimiento desde la perspectiva local, suele proveer mejores posibilidades y alternativas de acceder a información relevante, además de exponer servicios y dispositivos internos, como bases de datos, servidores internos, servicios de archivos compartidos, etc.

Esto da lugar a la siguiente etapa, el ***saqueo*** (*Pillaging*)

### Pillaging

> El ***Pillaging*** o ***Saqueo*** consiste en la examinación del rol del equipo en la red corporativa y en la recolección de información útil para el resto del ataque en base a esto.

Se empieza analizando configuraciones de red, por ejemplo:

- Interfaces de red
- ARP
- IPs y subredes
- Servicios
- Carpetas compartidas
- DNS
- Tráfico de red (*Sniffing*)

Con apoyo de esta información podemos, por ejemplo, determinar subdominios y subredes en la organización, políticas de contraseña y de red, determinar protocolos de comunicación, etc.

> El ***Pillaging*** también consiste en la recolección de cualquier información sensible y relevante al ataque como la busqueda de contraseñas en archivos locales, scripts, archivos de configuración, documentos y hasta correos.

Uno de las principales metas del **Pillaging** es determinar (y demostrar) el impacto, alcance y la **escalabilidad** de la explotación realizada.
Es decir, que tan lejos podemos llegar a partir de esta.

### Persistencia

> Una vez que tenemos un entendimiento general del sistema, deseamos mantener acceso al equipo comprometido, de modo que aunque la conexión sea interrumpida, podamos reacceder al equipo.

A veces se establece persistencia en el equipo antes de realizar cualquier otro procedimiento de post-explotación, pues existen casos donde no seremos capaces de establecer el acceso de la misma manera.

Dependiendo de la configuración del sistema, las formas de establecer persistencia varían mucho, por lo que es importante adaptarlas según el objetivo y realizarlas en cuanto se determine que sea necesario.

Por ejemplo, bajo un exploit de *Buffer overflow*, dado que es una forma muy inestable de mantener contacto, querremos establecer persistencia mediante alguna bakcdoor de forma rápida a comparación con otros tipos de explotación.

### Evaluación de Vulnerabilidades

> Ya que hemos establecido acceso persistente y hecho reconocimiento del entorno, podemos repetir el proceso de ***Evaluación de Vulnerabilidades*** desde la perspectiva interna.

Analizamos y priorizamos la información recolectada según sea el caso, bajo el objetivo de realizar una nueva explotación ya sea para escalar privilegios, obtener acceso a recursos protegidos, etc.

De encontrar una vulnerabilidad, revisitaremos la etapa de ***Explotación***, por lo que se reitera nuevamente la precaución con explotaciones dañinas al sistema.

### Escalamiento de privilegios

> Una de las técnicas más importantes y utilizadas durante la ***Post-explotación***, consiste en obtener el máximo privilegio posible en el sistema, usualmente, impersonando a las cuentas de administrador `root` para sistemas UNIX y `SYSTEM/Administrator` o similares para sistemas *Windows*.

No siempre consiste de técnicas avanzadas, muchas veces consiste en lograr obtener credenciales de otras cuentas con igual o mayores privilegios que la cuenta comprometida actual.

Otra fuente de escalamiento de privilegios usual, son las malas configuraciones de servicios o del propio sistema.

### Exfiltración de datos

> Esta técnica consiste en la extracción y transferencia de datos del sistema comprometido al nuestro, como atacantes.

No siempre es deseable, pero hay casos donde el cliente autoriza pruebas de exfiltración de datos, con el objetivo de verificar cuanta información sensible podemos extraer de sus sistemas y cómo.

Por supuesto, de tratarse de una prueba evasiva, tendremos que lidiar con controles de defensa como *DLP* (*Data Loss Prevention*), *EDR* (*Endpoint Detection and Response*) y con cualquier control de monitoreo de red.

Además, existen otras medidas de defensa a tomar en cuenta como lo es la **encriptación** de datos mediante distintos mecanismos.

Otra forma de poner a prueba la exfiltración de datos, y más segura, consiste en crear nosotros datos falsos en el equipo comprometido y tratar de extraer esos datos a nuestro equipo.
Así ponemos a prueba los controles de defensa, sin arriesgar información sensible real.

Es importante tomar en cuenta las **regulaciones legales** del manejo de datos y apegarnos a ellas, por esto mismo se prefiere simular la exfiltración antes que arriesgarnos a incumplirlas.

# Enlaces

[<- Anterior](Evaluacion.md) | [Siguiente ->](MovimientoLateral.md)