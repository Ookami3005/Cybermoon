[<- Índice](../Pentesting.md)
# Pre-Compromiso

> Es una fase de **preparación** de la prueba de penetración. Aqui se realizan preguntas, acuerdos y contratos legales, además de que se nos informa que desea ser incluido en la prueba y que **no**.

Podemos destacar 3 componentes principales de esta fase, que convencionalmente dictan el orden a seguir pero puede haber excepciones.

1. Cuestionario de ***alcance***
2. Reunión de ***pre-compromiso***
3. Reunión de ***inicio***

Sin embargo, antes de discutir cualquiera de estas secciones a detalle, los involucrados deben firmar un acuerdo de confidencialidad comúnmente denominado ***Non-Disclosure Agreement*** (*NDA*). Puede ser de distintos tipos como:

| Tipo               | Descripción                                                                                                                              |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| *NDA* unilateral   | Obliga a una de las partes a mantener toda la información del proceso confidencial, mientras que la otra es libre de compartirla.        |
| *NDA* bilateral    | Ambas partes están obligadas a mantener toda la información del proceso confidencial, protegiendo así nuestro trabajo.                   |
| *NDA* multilateral | En caso de haber más de un cliente o representante, obliga a todos los participantes a mantener la información del proceso confidencial. |

También, antes de continuar es importante conocer **quien tiene permitido contratarnos** para la realización de la prueba.
Generalmente, nos debe de contratar alguien con la suficiente autoridad en la empresa para responsabilizarse de esta.
De esta manera, pretendemos asegurarnos de que nuestro trabajo no sea utilizado para un propósito malicioso de algún empleado por ejemplo.

Los cargos más comunes y autorizados son:

- ==Directores== ejecutivos
- Directores técnicos
- Directores de seguridad de la información
- Directores de gestión de riesgo
- Gerentes de ==auditoría==
- Directores del área de *IT*

### Cuestionario de Alcance

> Antes del primer contacto formal con la empresa, generalmente se les envía un ***cuestionario*** para entender mejor los servicios que solicitan de nuestra parte.

Se busca que el cliente explique claramente el tipo de prueba o evaluación que desea, la perspectiva y el ambiente de prueba.

Usualmente consiste de un cuestionario de opción multiple preguntando si la prueba sera desde una perspectiva externa o interna, si se pondra aprueba aplicaciones web, empleados, aplicaciones móviles, etc.

- [ ] Evaluación de Vulnerabilidades interna
- [ ] Prueba de Penetración Interna
- [ ] Evaluación de Seguridad de Aplicaciones Web
- [ ] Evaluación *Red-Team*
- [ ] Evaluación de Ingeniería Social
- ...

Adicionalmente, se requiere que el cliente indique detalles relevantes de información como el nombre de la organizació, del contratante, dirección, información de contacto y datos ya mas pertinentes a la prueba como:

- Cuantos servidores activos
- Cuantas IPs serán puestas a prueba
- Cuantos dominios/subdominios
- Cuantas aplicaciones
- Cuantos empleados
- Si habrá controles de acceso en la red
- Cuanto tiempo disponemos para realizar la prueba
-  ...

Finalmente, también se deja claro la base de conocimiento, para acordar el tipo de prueba y el nivel de evasión manejado durante la prueba.

Es decir, si se tratará de una pruieba de caja negra, gris o blanca y que tan *sigilosos* requieren que seamos que se clasifica de la siguiente manera.

- ***No-evasivo*** consiste en que podemos ser tan escandalosos como queramos sin preocuparnos de ser detectados por los controles defensivos de la empresa.
- ***Evasión Híbrida***. Consiste usualmente en inicar de manera sigilosa e ir subiendo de agresividad poco a poco durante la prueba. Esto con el objetivo de probar la sensibilidad de sus controles de fensa.
- ***Totalmente evasivo***. Consiste en ser totalmente sigilosos durante toda la duración de la prueba.

---

***Finalmente***, con toda esta información podemos pensar y plaantear una propuesta para el cliente del tipo de prueba más adecuado para sus necesidades, planear y dividir la prueba a lo largo del tiempo indicado, informar del costo y demás detalles relevantes.

Toda la información recopilada del cuestionario, se resume en un documento denominado ***Documento de Alcance***, para su uso en posteriores reuniones.

### Reunión de Pre-Compromiso

> Durante esta reunión,  se discuten todos los detalles relevantes y esenciales de la propuesta de prueba que concluimos en la sección anterior al cliente, explicandolo a detalle. Además se revisa a detalle el **Documento de Alcance** y se corrige de ser necesario.

Con toda la información, alcance acordado y cualquier otro trato hecho en la reunión, se plantea tanto una ***Propuesta de Prueba de Penetración***, tambien conocida simplemente como ***Contrato*** o ***Scope of Work*** (*SoW*), como las ***Reglas de Compromiso*** (*RoE* por sus siglas en inglés).

El ***SoW*** incluye secciones como:

- ***NDA***. En caso de no haberse firmado ya
- ***Metas de la prueba***
- ***Alcance de la Prueba***
- ***Tipo de Prueba de Penetración***
- [***Metodologías formales***](MetodologiasFormales.md)
- ***Perspectiva de la Prueba***
- ***Tiempo estimado***
- ***Terceras partes que pueden o no pueden ponerse a prueba***
- ***Nivel de evasión***
- ***Restricciones y limitaciones de alcance***. Todo lo que esta absolutamente prohibido de incluir en la prueba
- ***Manejo legal de la información***. Bajo que regulaciones legales estamos obligados a tratar la información obtenida.
- ***Información de Contacto***
- ***Canales de Comunicación***
- ***Detalles acerca de la documentación***
- ***Términos de cobro***

Mientras que las ***Reglas de Compromiso***, creadas a partir de lo visto en la reunión, incluyen información como

- ***Introducción***. Descripción del documento
- ***Información del contratante***. Nombre de la empresa, Nombre completo del contratante, puesto de trabajo, etc.
- ***Información de los Pentesters***. Nombre de la compañia, Nombre completo de las personas involucradas, etc.
- ***Información de contacto***. De ambas partes tanto contratante como *Pentesters*.
- ***Propósito de la prueba***
- ***Objetivos de la prueba***
- ***Alcance***
- ==***Permisos escritos***==
- ***Canales de Comunicación***
- ***Tiempo estimado***
- ***Tipo de Prueba de Penetración***
- ***Metodología formal***
- ***Banderas/Objetivos de ataque***. A veces se nos indica que intentemos vulnerar un usuario en específico, exfiltrar un archivo en específico, algún dato en específico, con el único objetivo de verificar la seguridad de este.
- ***Manejo de evidencia e información***
- ***Respaldos del sistema***. Como se debe respaldar la información de la prueba previo a la prueba.
- ***Manejo de Incidentes***. En caso de algun incidente, que acciones tomar, sis uspender o continuar la prueba, etc.
- ***Reuniones de Retroalimentación***. Cada cuando, con quien, etc.
- ***Documentación***
- ***Repetición de la Prueba***. En caso de desearse que se lleve la prueba a cabo de nuevo, una vez que se consideren mitigadas las vulnerabilidades

### Reunión de Inicio

> Esta reunión generalmente ocurre despues de firmar todos los documentos requeridos y suele ser en persona con todas las personas relevantes de la organización, desde personal de *IT* hasta personales de otras áreas si es preciso.

También se explican todos los detalles pertinentes que no hayan quedado claros y se describen algunas condiciones de pausa en la prueba, por ejemplo en caso de encontrar una **vulnerabilidad crítica**, en caso de que el sistema caiga, en caso de encontrar evidencia de cualquier actividad ilegal en el sistema o en el importante caso de encontrar un actor de amenaza real en la red.

Además, se reitera de nueva cuenta los riesgos potenciales que conlleva realizar una **prueba de penetración**, por ejemplo, la presencia de registros y alarmas maliciosas a causa de la prueba, tal vez el bloqueo de algunas cuentas o direcciones IP, y sobre todo que recalcar que nos contacten en caso de cualquier impacto no deseado sobre el sistema para que se reajusten las actividades.

Finalmente, con la conclusión ***satisfactoria*** de esta reunión y habiendo cubierto todos los puntos, da inicio todo el procedimiento de la **prueba**, siguiendo a posteriores etapas de este proceso.

---

Para terminar, y después de tanto texto, un pequeño resumen de los acuerdos potencialmente requeridos, tanto vistos como algunos extras, es:

| Nombre en español                                   | Nombre en inglés                                              | Creación                                       | Descripción breve                                                                                                                                                                            |
| --------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Acuerdo de Confidencialidad                         | Non-Disclosure Agreement (*NDA*)                              | Usualmente antes del **contacto inicial**.     | Nos obliga a mantener confidencial toda la información obtenida durante la prueba.                                                                                                           |
| Cuestionario de Alcance                             | Scoping Questionnaire                                         | Antes de la **reunión de Pre-Compromiso**.     | Cuestionamos y analizamos las necesidades y deseos del cliente,                                                                                                                              |
| Documento de Alcance                                | Scoping Document                                              | Durante la **reunión de Pre-Compromiso**.      | Resumen conciso claro y ***acordado*** de las necesidades del cliente                                                                                                                        |
| Propuesta de Prueba de Penetración/Contrato         | *Penetration Testing Proposal (Contract/Scope of Work (SoW))* | Durante la **reunión de Pre-compromiso**.      | Información clara y detallada de la prueba de penetración por llevarse a cabo.                                                                                                               |
| Reglas de Compromiso                                | Rules of Engagement (RoE)                                     | Antes de la **reunión de inicio**.             | Toda la información ***acordada*** respecto a la prueba, además de designación de permisos y responsabilidades                                                                               |
| Consentimiento del Contratante para Pruebas Físicas | *Contractors Agreement (Physical Assessments)*                | Antes de la **reunión de inicio**.             | Otorga el consentimiento del contratante de realizar pruebas físicas en sus instalaciones, además de protegernos de la ley en caso de ser acusados por personas no conscientes de la prueba. |
| Reportes                                            | *Reports*                                                     | Durante y después la **prueba de penetración** | Toda la documentación pertinente a la prueba.                                                                                                                                                |

Todos estos documentos deben ser revisados y valorados por un abogado después de su creación y acuerdo.

# Enlaces

[<- Anterior](HFC/Pentesting/metodologia/Intro.md) | [Siguiente ->](Reconocimiento.md)