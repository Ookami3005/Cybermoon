[<- Índice](../Pentesting.md)
# Crackeo de Hashes básico

> En esta nota reside solo el uso más básico de la herramienta `john` para el crackeo de hashes sencillos.

## John

A este punto ya tenemos una buena idea de que es un *hash* y la utilidad de crackearlos, por lo que repasaré una de las herramientas más famosas para crackear *hashes*:

> ***John The Reaper***

No solo es universalmente reconocido, si no que ofrece una versatilidad enorme a la hora de utilizarlo.

Por defecto, ==*John* espera formatos *"completos"* de *hashes*== de contraseñas. Por ejemplo los formatos de *Linux* que indican el algoritmo utilizado, el *hash*, *salt*, etc.
Es así porque así es más fácil identificar el tipo de *hash* y el algoritmo de crackeo más adecuado.

### Formatos

> `john` admite una alta variedad de formatos que podemos listar de la siguiente manera:

```bash
john --list=formats
```

##### ¿Y cómo sabemos el formato de el *hash* que queremos crackear?

Existen múltiples páginas en Internet que identifican el tipo de hash cuando les brindas un *hash* muestra.

Adicionalmente, existe la poderosa herramienta en terminal `haiti` para sistemas *UNIX* que permite realizar esto desde la terminal, además de indicarnos el formato de *hash* que debemos utilizar en `john`:

```bash
# Hash como cadena
haiti -e "[hash]"
```

O si está en un archivo:

```bash
haiti - < [archivo_hash]
```

### Uso

Con esto dicho, el uso básico de *John* es:

```bash
john --wordlist=/ruta/al/diccionario --format=[formato] [archivo_hash]
```

Donde el último argumento es el archivo que contiene ***únicamente*** el *hash* que se desea crackear.

Si no hemos podido identificar el tipo de *hash* (o nos da flojera) o si es un *hash* en un formato más tradicional (como los de *Unix* en `etc/passwd`), podemos omitir la indicación del formato y `john` lo deducirá (en el mejor de los casos):

```bash
john --wordlist=/ruta/al/diccionario [archivo_hash]
```

También es posible indicar a *John* que reciba una lista de palabras mediante ***entrada estandar*** para usarlas como diccionario con la bandera `--stdin`, para casos específicos donde la salida de algún comando es el ***diccionario*** que deseamos utilizar, por ejemplo:

```bash
cut -d ":" -f 1 /etc/passwd | john --stdin [archivo]
```

En este ejemplo, no hacemos más que utilizar los nombres de los usuarios del sistema como diccionario.

Una vez crackeada una contraseña, si repetimos el proceso `john` nos avisará que ya ha sido crackeada, pero no nos la mostrará. Si deseamos volver a verla debemos indicarselo con la bandera `--show`, además de indicarle el archivo y de ser necesario el formato.

```bash
john --show --format=raw-md5 [archivo]
```

### Scripts adicionales

> Otra de las maravillas de *John* radica en los tantos *Scripts* auxiliares que permiten adaptar varios formatos de archivos *"crackeables"* a un *hash* que *John* pueda crackear.

Por ejemplo, supongamos que poseemos una llave privada *ssh* que deseamos saber su *passphrase*, entonces podemos ejecutar el comando `ssh2john` con la llave y guardar la salida en un archivo:

```bash
ssh2john [llave_ssh] > hash_llave
```

Ahora podemos utilizar `john` con ese archivo de la manera tradicional y obtener la contraseña que resguarda la llave *ssh*:

```bash
john --wordlist=ruta/al/diccionario hash_llave
```

> Así como `ssh2john` existen muchos más *Scripts* que acompañan a *John* en su versión *Jumbo* para extender su funcionalidad a varios tipos de archivos, como `zip2john`, `keepass2john`, `gpg2john`, etc.

## Ejemplos de formatos

Algunos ejemplos de como utilizar `john` para crackear *hashes* comunes son:

### Formatos "crudos" (`Raw`)

> Cuando poseemos **únicamente** el *hash* se denomina *hash crudo*:

***Ejemplo***:

Este es un *hash MD5* crudo:

```
48bb6e862e54f2a795ffc4e541caed4d
```

***Comando***:

```bash
john --wordlist=[ruta_diccionario] --format=Raw-MD5 [archivo]

# > easy
```

### Bcrypt

> Formato especialmente complejo de crackear, se recomienda reducir lo más posible el tamaño del diccionario (o las opciones en general).

Es un *hash* típico de *BSD* y de algunos *Suse Linux* que utiliza un algoritmo *Blowfish*.

***Ejemplo***:

Se divide en 3 secciones, la primera (`2y`) indica el tipo de *bcrypt*, la segunda (`12`) se relaciona con la complejidad de los cálculos y la última es el *hash* como tal.

```
$2y$12$Dwt1BZj6pcyc3Dy1FWZ5ieeUznr71EeNkJkUlypTsgbX1H68wsRom
```

***Comando***:

```bash
john --wordlist=[ruta_diccionario] --format=bcrypt [archivo]
```

### NTLM

> Los *hashes* **NTLM** o **NT** son los *hashes* predeterminados por sistemas *Windows* para almacenar credenciales de usuario.

Se generan inicialmente de un algoritmo *MD4* seguido de 3 rondas de algoritmo de cifrado *DES* en cada mitad del *hash*.

Por esto último **suelen ser ==erroneamente identificados== como *hashes MD4 o MD5***.

Si tienes problema crackeando un *hash MD4 o MD5* no olvides tener esto en cuenta.

***Ejemplo***:

```
1DFECA0C002AE40B8619ECF94819CC1B
```

***Comando***:

```bash
john --wordlist=[ruta_diccionario] --format=NT [archivo]
```

### Formatos `crypt`

Antes he mencionado los formatos de *hashes* Unix que contenian algunos datos extras como el algoritmo de *hasheo* o *salts* por ejemplo.

> Estos tipo de formatos se les denomina según el algoritmo de su *hash* como `algoritmocrypt`.

Por ejemplo `sha1crypt`, `md5crypt`, `sha512crypt`, etc.

***Ejemplo***:

Este es un *sha512crypt*, vemos que la primera sección (`6`) indica el algoritmo de *hash* utilizado (precisamente *SHA-512*).

La siguiente sección es el *salt* (`aReallyHardSalt`), un valor aleatorio que se añade a la contraseña antes de generar el *hash* para mejorar la seguridad.

La última sección es el *hash* final generado.

***Ejemplo***:

```
$6$aReallyHardSalt$6WKUTqzq.UQQmrm0p/T7MPpMbGNnzXPMAXi4bJMl9be.cfi3/qxIf.hsGpS41BqMhSrHVXgMpdjS6xeKZAs02.
```

***Comando***:

```bash
john --wordlist=[ruta_diccionario] --format=sha512crypt [archivo]
```

Si deseas introducirte un poco más al *Hash Cracking* y sobre todo a la herramienta *John*, ahondaré un poco más el tema en la nota de [Crackeo de Hashes avanzado](HashCrackingAvanzado.md).

# Enlaces

[<- Esteganografía](Esteganografia.md) |